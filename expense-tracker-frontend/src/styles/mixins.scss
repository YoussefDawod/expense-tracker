// ============================================
// ðŸ§° SCSS MIXINS - REUSABLE STYLE PATTERNS
// Purpose: Helpers for responsive, layout, components, color & theming
// ============================================

// --------------------------------------------
// Responsive breakpoints (mobile-first)
// --------------------------------------------
@mixin mobile { @media (max-width: 639px) { @content; } }
@mixin tablet { @media (min-width: 640px) and (max-width: 1023px) { @content; } }
@mixin desktop { @media (min-width: 1024px) { @content; } }
@mixin reduced-motion { @media (prefers-reduced-motion: reduce) { @content; } }

// --------------------------------------------
// Flex helpers
// --------------------------------------------
@mixin flex-center { display: flex; align-items: center; justify-content: center; }
@mixin flex-between { display: flex; align-items: center; justify-content: space-between; }

// --------------------------------------------
// Gradient utility
// --------------------------------------------
@mixin gradient-background($start, $end, $direction: 135deg) {
  background: linear-gradient($direction, $start, $end);
}

// --------------------------------------------
// Card shell
// --------------------------------------------
@mixin card($padding: var(--lg)) {
  background: var(--surface);
  border-radius: var(--r-lg);
  padding: $padding;
  box-shadow: var(--sh-md);
  transition: all var(--tr);
  &:hover { box-shadow: var(--sh-lg); }
}

// --------------------------------------------
// Button base
// --------------------------------------------
@mixin button-base {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--sm);
  padding: var(--sm) var(--lg);
  border: none;
  border-radius: var(--r-md);
  font-weight: var(--fw-m);
  font-size: var(--fs-md);
  cursor: pointer;
  transition: all var(--tr-fast);
  position: relative;
  &:disabled { opacity: 0.5; cursor: not-allowed; }
  &:focus { outline: none; }
  &:focus-visible {
    outline: var(--focus-ring-width) solid var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
    box-shadow: 0 0 0 calc(var(--focus-ring-width) + var(--focus-ring-offset))
                rgba(var(--primary-rgb, 99, 102, 241), var(--focus-ring-opacity));
  }
}

// --------------------------------------------
// Input base (uses theme vars)
// --------------------------------------------
@mixin input-base {
  width: 100%;
  padding: var(--sm) var(--md);
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: var(--r-md);
  color: var(--tx);
  font-size: var(--fs-md);
  font-family: var(--ff-base);
  transition: all var(--tr-fast);
  &:focus {
    outline: none; border-color: var(--primary); background: var(--bg);
    box-shadow: 0 0 0 3px rgba(var(--primary-rgb, 99, 102, 241), 0.1);
  }
  &:focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; }
  &::placeholder { color: var(--tx-muted); opacity: 0.65; }
  &:disabled { opacity: 0.5; cursor: not-allowed; background: var(--surface-2); }
}

// --------------------------------------------
// Color utilities
// --------------------------------------------
@function color-rgb($c) { @return #{red($c)}, #{green($c)}, #{blue($c)}; }
@function contrast-color($c, $dark: #0b0b0b, $light: #ffffff) {
  @return if(lightness($c) > 60, $dark, $light);
}
@function shade($c, $pct) { @return mix(black, $c, $pct); }
@function tint($c, $pct) { @return mix(white, $c, $pct); }
@function alpha($c, $a) { @return rgba($c, $a); }

// --------------------------------------------
// THEME GENERATOR
// Generates a full CSS custom properties set from ~6 base colors
// Keys expected in $palette: background, text, primary, secondary, accent,
//                             success, warning, error, info (success..info optional)
// --------------------------------------------
@mixin generate-theme($name, $palette) {
  $bg: map-get($palette, background);
  $tx: map-get($palette, text);
  $pri: map-get($palette, primary);
  $sec: map-get($palette, secondary);
  $acc: map-get($palette, accent);
  $success: if(map-has-key($palette, success), map-get($palette, success), #10b981);
  $warning: if(map-has-key($palette, warning), map-get($palette, warning), #f59e0b);
  $error: if(map-has-key($palette, error), map-get($palette, error), #ef4444);
  $info: if(map-has-key($palette, info), map-get($palette, info), #3b82f6);

  [data-theme="#{$name}"] {
    /* Core */
    --background: #{$bg};
    --bg: #{$bg};
    --text: #{$tx};
    --tx: #{$tx};
    --tx-muted: #{tint($tx, 45%)};
    --text-disabled: #{tint($tx, 65%)};

    /* Surfaces & borders */
    --surface: #{tint($bg, 6%)};
    --surface-2: #{tint($bg, 10%)};
    --overlay: #{alpha($tx, 0.5)};
    --border: #{alpha(contrast-color($bg, #111111, #eeeeee), 0.12)};
    --border-light: #{alpha(contrast-color($bg, #111111, #eeeeee), 0.06)};
    --border-strong: #{alpha(contrast-color($bg, #111111, #eeeeee), 0.18)};
    --divider: var(--border);

    /* Brand */
    --primary: #{$pri};
    --pri: var(--primary);
    --pri-hover: #{shade($pri, 10%)};
    --primary-rgb: #{color-rgb($pri)};
    --on-primary: #{contrast-color($pri)};

    --secondary: #{$sec};
    --sec: var(--secondary);
    --sec-hover: #{shade($sec, 10%)};
    --on-secondary: #{contrast-color($sec)};

    --accent: #{$acc};
    --acc: var(--accent);
    --acc-hover: #{shade($acc, 10%)};
    --on-accent: #{contrast-color($acc)};

    /* Status */
    --success: #{$success};
    --success-hover: #{shade($success, 10%)};
    --success-rgb: #{color-rgb($success)};
    --on-success: #{contrast-color($success)};
    --warning: #{$warning};
    --warning-hover: #{shade($warning, 10%)};
    --warning-rgb: #{color-rgb($warning)};
    --on-warning: #{contrast-color($warning)};
    --error: #{$error};
    --error-hover: #{shade($error, 10%)};
    --error-rgb: #{color-rgb($error)};
    --on-error: #{contrast-color($error)};
    --info: #{$info};
    --info-hover: #{shade($info, 10%)};
    --info-rgb: #{color-rgb($info)};
    --on-info: #{contrast-color($info)};

    /* Shadows */
    --sh-sm: 0 1px 2px 0 #{alpha(#000, 0.05)};
    --sh-md: 0 4px 6px -1px #{alpha(#000, 0.08)}, 0 2px 4px -1px #{alpha(#000, 0.06)};
    --sh-lg: 0 10px 15px -3px #{alpha(#000, 0.12)}, 0 4px 6px -2px #{alpha(#000, 0.08)};
    --sh-xl: 0 20px 25px -5px #{alpha(#000, 0.16)}, 0 10px 10px -5px #{alpha(#000, 0.10)};
  }
}

// --------------------------------------------
// Focus & accessibility
// --------------------------------------------
@mixin focus-ring {
  &:focus { outline: none; }
  &:focus-visible {
    outline: var(--focus-ring-width) solid var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
    box-shadow: 0 0 0 calc(var(--focus-ring-width) + var(--focus-ring-offset))
                rgba(var(--primary-rgb, 99, 102, 241), var(--focus-ring-opacity));
  }
}

@mixin focus-ring-inset {
  &:focus { outline: none; border-color: var(--focus-ring-color);
    box-shadow: 0 0 0 calc(var(--focus-ring-width) + 1px)
                rgba(var(--primary-rgb, 99, 102, 241), var(--focus-ring-opacity)); }
  &:focus-visible { outline: var(--focus-ring-width) solid var(--focus-ring-color); outline-offset: 0; }
}

@mixin focus-ring-custom($color, $color-rgb: null) {
  &:focus { outline: none; }
  &:focus-visible {
    outline: var(--focus-ring-width) solid $color;
    outline-offset: var(--focus-ring-offset);
    @if $color-rgb { box-shadow: 0 0 0 calc(var(--focus-ring-width) + var(--focus-ring-offset)) rgba($color-rgb, var(--focus-ring-opacity)); }
  }
}

@mixin skip-link {
  position: absolute; top: -100px; left: 0; padding: var(--md);
  background: var(--primary); color: white; z-index: var(--z-max);
  transition: top var(--tr-fast); &:focus { top: 0; }
}

// --------------------------------------------
// Skeleton loading
// --------------------------------------------
@mixin skeleton {
  background: linear-gradient(90deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.16) 50%, rgba(255,255,255,0.08) 100%);
  background-size: 200% 100%; animation: skeleton-loading 1.5s ease-in-out infinite;
}
@keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

// ============================================
// ðŸ§° SCSS MIXINS - REUSABLE STYLE PATTERNS
// ============================================

// Responsive breakpoints
@mixin mobile {
  @media (max-width: 639px) {
    @content;
  }
}

@mixin tablet {
  @media (min-width: 640px) and (max-width: 1023px) {
    @content;
  }
}

@mixin desktop {
  @media (min-width: 1024px) {
    @content;
  }
}

// Flex helpers
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

@mixin flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

// Gradient utility
@mixin gradient-background($start, $end, $direction: 135deg) {
  background: linear-gradient($direction, $start, $end);
}

// Card shell
@mixin card($padding: var(--lg)) {
  background: var(--surface);
  border-radius: var(--r-lg);
  padding: $padding;
  box-shadow: var(--shadow-md);
  transition: all var(--tr);

  &:hover {
    box-shadow: var(--shadow-lg);
  }
}

// Button base
@mixin button-base {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--sm);
  padding: var(--sm) var(--lg);
  border: none;
  border-radius: var(--r-md);
  font-weight: var(--fw-m);
  font-size: var(--fs-md);
  cursor: pointer;
  transition: all var(--tr-fast);
  position: relative;

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: var(--focus-ring-width) solid var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
    box-shadow: 0 0 0 calc(var(--focus-ring-width) + var(--focus-ring-offset)) 
                rgba(var(--primary-rgb, 99, 102, 241), var(--focus-ring-opacity));
  }
}

// Input base
@mixin input-base {
  width: 100%;
  padding: var(--sm) var(--md);
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: var(--r-md);
  color: var(--tx);
  font-size: var(--fs-md);
  font-family: var(--ff-base);
  transition: all var(--tr-fast);

  &:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--bg);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  &:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }

  &::placeholder {
    color: var(--tx-muted);
    opacity: 0.65;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--surface-2);
  }
}

// Text truncation
@mixin truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

@mixin line-clamp($lines: 2) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

// Scrollbar styling
@mixin custom-scrollbar($width: 8px, $track-color: transparent, $thumb-color: var(--tx-muted)) {
  &::-webkit-scrollbar {
    width: $width;
    height: $width;
  }

  &::-webkit-scrollbar-track {
    background: $track-color;
  }

  &::-webkit-scrollbar-thumb {
    background: $thumb-color;
    border-radius: var(--r-full);

    &:hover {
      background: var(--tx);
    }
  }
}

// Skeleton loading
@mixin skeleton {
  background: linear-gradient(
    90deg,
    var(--skeleton-from) 0%,
    var(--skeleton-to) 50%,
    var(--skeleton-from) 100%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
}

@keyframes skeleton-loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

// ============================================
// ðŸŽ¯ FOCUS & ACCESSIBILITY MIXINS
// ============================================

// Enhanced focus ring (default)
@mixin focus-ring {
  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: var(--focus-ring-width) solid var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
    box-shadow: 0 0 0 calc(var(--focus-ring-width) + var(--focus-ring-offset)) 
                rgba(var(--primary-rgb, 99, 102, 241), var(--focus-ring-opacity));
  }
}

// Focus ring for inputs (no offset, integrated with border)
@mixin focus-ring-inset {
  &:focus {
    outline: none;
    border-color: var(--focus-ring-color);
    box-shadow: 0 0 0 calc(var(--focus-ring-width) + 1px) 
                rgba(var(--primary-rgb, 99, 102, 241), var(--focus-ring-opacity));
  }

  &:focus-visible {
    outline: var(--focus-ring-width) solid var(--focus-ring-color);
    outline-offset: 0;
  }
}

// Focus ring with custom color
@mixin focus-ring-custom($color, $color-rgb: null) {
  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: var(--focus-ring-width) solid $color;
    outline-offset: var(--focus-ring-offset);
    
    @if $color-rgb {
      box-shadow: 0 0 0 calc(var(--focus-ring-width) + var(--focus-ring-offset)) 
                  rgba($color-rgb, var(--focus-ring-opacity));
    }
  }
}

// Skip to content link (accessibility)
@mixin skip-link {
  position: absolute;
  top: -100px;
  left: 0;
  padding: var(--md);
  background: var(--primary);
  color: white;
  z-index: 9999;
  transition: top var(--tr-fast);

  &:focus {
    top: 0;
  }
}
